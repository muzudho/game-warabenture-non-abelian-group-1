<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>非可換な群 (MIT ライセンス / 改造・再配布許可)</title>
	<script>
		var scene = "";
		var intervalFrame = 0;
		
		/** 問題指定。 */
		var problemId = 1;
		var talkText = "";
		
		/** 棋譜。 */
		var record = "";
		var answerList = [];
		
		/** ゲームの時計を開始。 */
		function start_timer() {
			setInterval(
				() => {
					switch (scene) {
						case "title-0":
							document.getElementById("title").style.visibility = "visible";
							scene = "title-1";
							break;
							
						case "title-1":
							let left = document.getElementById("title").style.left;
							// 末尾の px を外す。
							left = left.substring(0, left.length - 2);
							if (0 < left) {
								// alert("left = " + left);
								left -= 20;
								document.getElementById("title").style.left = left + "px";
							} else {
								scene = "title-window-0";
								intervalFrame = 30;
							}
							break;

						case "title-window-0":
							if (0 < intervalFrame) {
								intervalFrame -= 1;
							} else {
								scene = "title-window-1";
							}
							break;

						case "title-window-1":
							document.getElementById("title-scene").style.visibility = "visible";
							scene = "finished";
							break;

						case "start-game":
							document.getElementById("title").style.visibility = "hidden";
							document.getElementById("title-scene").style.visibility = "hidden";
							document.getElementById("go-to-next-stage").style.visibility = "hidden";
							document.getElementById("development-scene").style.visibility = "visible";
							reset();
							problem(problemId);
							document.getElementById("talkText").innerHTML = talkText;
							document.getElementById("hint").src = "./img/hint-" + problemId +".png";
							document.getElementById("hint").style.visibility = "visible";
							document.getElementById("face").src = "./img/face-" + problemId +".png";
							document.getElementById("face").style.visibility = "visible";
							scene = "finished";
							break;
					}
				},
				16
			);
		}

		/** ステージの初期化。 */
		function initStage() {
			// 棋譜。
			record = "";
			document.getElementById("record").innerHTML = record;
			
			// 解答。
			answerList = [];
			document.getElementById("answer").innerHTML = "";
		}
		
		/** ゲーム画面の初期化。 */
		function init() {
			scene = "title-0";
			intervalFrame = 0;
			document.getElementById("title").style.left = "1920px";
			document.getElementById("title").style.visibility = "hidden";
			document.getElementById("title-scene").style.visibility = "hidden";
			document.getElementById("development-scene").style.visibility = "hidden";
			document.getElementById("congratulations").style.visibility = "hidden";
			document.getElementById("hint").style.visibility = "hidden";
			document.getElementById("face").style.visibility = "hidden";
			initStage();
		}
		
		/** ゲームを開始します。 */
		function startStage(stageNumber) {
			initStage();
			problemId = stageNumber;
			scene = "start-game";			
		}
		
		/** 次のステージに進みます。 */
		function startNextStage() {
			problemId = problemId + 1;

			// スキップ。
			if(problemId == 8) {
				problemId = 12;
			}
			
			// とりあえずループ。
			if(12 < problemId) {
				problemId = 1;
			}
			
			startStage(problemId);
		}
		
		/** 4箇所を１つずらします。 */
		function shift4(a, b, c, d) {
			// 展開図
			var temp = document.getElementById("tile-" + d).src;
			document.getElementById("tile-" + d).src = document.getElementById("tile-" + c).src;
			document.getElementById("tile-" + c).src = document.getElementById("tile-" + b).src;
			document.getElementById("tile-" + b).src = document.getElementById("tile-" + a).src;
			document.getElementById("tile-" + a).src = temp;
			
			// 立体図
			var temp = document.getElementById("dia-" + d).src;
			document.getElementById("dia-" + d).src = document.getElementById("dia-" + c).src;
			document.getElementById("dia-" + c).src = document.getElementById("dia-" + b).src;
			document.getElementById("dia-" + b).src = document.getElementById("dia-" + a).src;
			document.getElementById("dia-" + a).src = temp;
			
			// ひしがた画像の調整
			document.getElementById("dia-0").src = document.getElementById("dia-0").src.replace(/diamond-[ab]/, "diamond-c");
			document.getElementById("dia-1").src = document.getElementById("dia-1").src.replace(/diamond-[ab]/, "diamond-c");
			document.getElementById("dia-2").src = document.getElementById("dia-2").src.replace(/diamond-[ab]/, "diamond-c");
			document.getElementById("dia-3").src = document.getElementById("dia-3").src.replace(/diamond-[ab]/, "diamond-c");
			document.getElementById("dia-4").src = document.getElementById("dia-4").src.replace(/diamond-[ac]/, "diamond-b");
			document.getElementById("dia-5").src = document.getElementById("dia-5").src.replace(/diamond-[ac]/, "diamond-b");
			document.getElementById("dia-6").src = document.getElementById("dia-6").src.replace(/diamond-[ac]/, "diamond-b");
			document.getElementById("dia-7").src = document.getElementById("dia-7").src.replace(/diamond-[ac]/, "diamond-b");
			document.getElementById("dia-8").src = document.getElementById("dia-8").src.replace(/diamond-[bc]/, "diamond-a");
			document.getElementById("dia-9").src = document.getElementById("dia-9").src.replace(/diamond-[bc]/, "diamond-a");
			document.getElementById("dia-10").src = document.getElementById("dia-10").src.replace(/diamond-[bc]/, "diamond-a");
			document.getElementById("dia-11").src = document.getElementById("dia-11").src.replace(/diamond-[bc]/, "diamond-a");
			document.getElementById("dia-12").src = document.getElementById("dia-12").src.replace(/diamond-[ab]/, "diamond-c");
			document.getElementById("dia-13").src = document.getElementById("dia-13").src.replace(/diamond-[ab]/, "diamond-c");
			document.getElementById("dia-14").src = document.getElementById("dia-14").src.replace(/diamond-[ab]/, "diamond-c");
			document.getElementById("dia-15").src = document.getElementById("dia-15").src.replace(/diamond-[ab]/, "diamond-c");
			document.getElementById("dia-16").src = document.getElementById("dia-16").src.replace(/diamond-[bc]/, "diamond-a");
			document.getElementById("dia-17").src = document.getElementById("dia-17").src.replace(/diamond-[bc]/, "diamond-a");
			document.getElementById("dia-18").src = document.getElementById("dia-18").src.replace(/diamond-[bc]/, "diamond-a");
			document.getElementById("dia-19").src = document.getElementById("dia-19").src.replace(/diamond-[bc]/, "diamond-a");
			document.getElementById("dia-20").src = document.getElementById("dia-20").src.replace(/diamond-[ac]/, "diamond-b");
			document.getElementById("dia-21").src = document.getElementById("dia-21").src.replace(/diamond-[ac]/, "diamond-b");
			document.getElementById("dia-22").src = document.getElementById("dia-22").src.replace(/diamond-[ac]/, "diamond-b");
			document.getElementById("dia-23").src = document.getElementById("dia-23").src.replace(/diamond-[ac]/, "diamond-b");
		}
		
		/**
			キューブをひねります。
			  11 0
			10	   1
			9	    2
			8		3
			 7     4
			   6 5
		 */
		function rotateOnly(handle) {
			switch(handle)
			{
				case 0:
					shift4(8, 0, 19, 20);
					shift4(10, 2, 17, 22);
					shift4(5, 4, 6, 7);
					break;
				case 1:
					shift4(9, 1, 18, 21);
					shift4(11, 3, 16, 23);
					shift4(12, 13, 15, 14);
					break;
				case 2:
					shift4(12, 2, 7, 21);
					shift4(14, 3, 5, 20);
					shift4(9, 8, 10, 11);
					break;
				case 3:
					shift4(13, 0, 6, 23);
					shift4(15, 1, 4, 22);
					shift4(16, 17, 19, 18);
					break;
				case 4:
					shift4(9, 13, 17, 5);
					shift4(8, 12, 16, 4);
					shift4(3, 1, 0, 2);
					break;
				case 5:
					shift4(11, 15, 19, 7);
					shift4(10, 14, 18, 6);
					shift4(21, 23, 22, 20);
					break;
				case 6:
					shift4(21, 18, 1, 9);
					shift4(23, 16, 3, 11);
					shift4(14, 15, 13, 12);
					break;
				case 7:
					shift4(20, 19, 0, 8);
					shift4(22, 17, 2, 10);
					shift4(7, 6, 4, 5);
					break;
				case 8:
					shift4(23, 6, 0, 13);
					shift4(22, 4, 1, 15);
					shift4(18, 19, 17, 16);
					break;
				case 9:
					shift4(21, 7, 2, 12);
					shift4(20, 5, 3, 14);
					shift4(11, 10, 8, 9);
					break;
				case 10:
					shift4(7, 19, 15, 11);
					shift4(6, 18, 14, 10);
					shift4(20, 22, 23, 21);
					break;
				case 11:
					shift4(5, 17, 13, 9);
					shift4(4, 16, 12, 8);
					shift4(2, 0, 1, 3);
					break;
			}
		}

		/**
			キューブをひねり、棋譜に残します。
		 */
		function rotateAndRecord(handle, moveLabel) {
			rotateOnly(handle);
			
			// 棋譜。
			record += " " + moveLabel; // handle;
			document.getElementById("record").innerHTML = record;

			// 勝利判定。
			judge();
		}

		/**
			視角を回すだけ。
			  5  0			  	    
			4      1
			  3  2
		 */
		function rotateAngle(handle) {
			switch(handle)
			{
				case 0:
					rotateOnly(0);
					rotateOnly(1);
					break;
				case 1:
					rotateOnly(2);
					rotateOnly(3);
					break;
				case 2:
					rotateOnly(4);
					rotateOnly(5);
					break;
				case 3:
					rotateOnly(6);
					rotateOnly(7);
					break;
				case 4:
					rotateOnly(8);
					rotateOnly(9);
					break;
				case 5:
					rotateOnly(10);
					rotateOnly(11);
					break;
			}
			
			rotateButtonAngle(handle);
		}
		
		/** 回転ボタンのラベルを入れ替えます。 */
		function shift4RotateButton(a, b, c, d) {
			// フロント
			var tempLabel = document.getElementById("front-r" + a + "-button").textContent;
			document.getElementById("front-r" + a + "-button").textContent = document.getElementById("front-r" + b + "-button").textContent;
			document.getElementById("front-r" + b + "-button").textContent = document.getElementById("front-r" + c + "-button").textContent;
			document.getElementById("front-r" + c + "-button").textContent = document.getElementById("front-r" + d + "-button").textContent;
			document.getElementById("front-r" + d + "-button").textContent = tempLabel;
			
			// バック		
			tempLabel = document.getElementById("back-r" + a + "-button").textContent;
			document.getElementById("back-r" + a + "-button").textContent = document.getElementById("back-r" + b + "-button").textContent;
			document.getElementById("back-r" + b + "-button").textContent = document.getElementById("back-r" + c + "-button").textContent;
			document.getElementById("back-r" + c + "-button").textContent = document.getElementById("back-r" + d + "-button").textContent;
			document.getElementById("back-r" + d + "-button").textContent = tempLabel;
		}
		
		/**
			回転ボタンの場所を入れ替える。
			  5  0			  	    
			4      1
			  3  2
		 */
		function rotateButtonAngle(handle) {
			switch(handle)
			{
				case 0:
					shift4RotateButton(11, 9, 5, 3);
					shift4RotateButton(10, 8, 4, 2);
					break;
				case 1:
					shift4RotateButton(0, 10, 6, 4);
					shift4RotateButton(1, 11, 7, 5);
					break;
				case 2:
					shift4RotateButton(0, 2, 4, 8);
					shift4RotateButton(1, 3, 5, 9);
					break;
				case 3:
					shift4RotateButton(2, 4, 8, 10);
					shift4RotateButton(3, 5, 9, 11);
					break;
				case 4:
					shift4RotateButton(0, 4, 6, 10);
					shift4RotateButton(1, 5, 7, 11);
					break;
				case 5:
					shift4RotateButton(0, 2, 6, 8);
					shift4RotateButton(1, 3, 7, 9);
					break;
			}			
		}
		
		/** 反対方向のハンドルを取得。 */
		function getReversedHandle(handle)
		{
			var reverse;
			switch(handle)
			{
				case 0:
					reverse = 7;
					break;
				case 1:
					reverse = 6;
					break;
				case 2:
					reverse = 9;
					break;
				case 3:
					reverse = 8;
					break;
				case 4:
					reverse = 11;
					break;
				case 5:
					reverse = 10;
					break;
				case 6:
					reverse = 1;
					break;
				case 7:
					reverse = 0;
					break;
				case 8:
					reverse = 3;
					break;
				case 9:
					reverse = 2;
					break;
				case 10:
					reverse = 5;
					break;
				case 11:
					reverse = 4;
					break;
			}
			return reverse;
		}

		/**
		 * 問題作成時に キューブをひねります。棋譜に残し、解答も作成します。
		 */
		function rotateInProblem(handle) {
			rotateAndRecord(handle, handle);
			
			// 解答は、反対方向に回す。
			var reverse = getReversedHandle(handle);
			
			// 解答の作成。
			answerList.push(reverse);
		}
		
		/** 単純なシャッフルではなく、キャラクター付けを行う。 */
		function problem(id)
		{
			// 解答作成のためにクリア。
			answerList = [];
		
			switch(id)
			{
				case 1:
				
					// チルノ
					talkText='チルノ 「どこを１回、回したか当ててみろ！」';
					
					// ランダムでハンドルを１回動かすだけ。
					// 0~11
					var handle = Math.round( Math.random()*11 );
					rotateInProblem(handle);
					break;

				case 2:
				
					// 宮古芳香
					talkText='宮古芳香 「２回も 回したのだ」';
					
					// ランダムでハンドルを１つ選び、それを 2つ進めるだけ。
					// 0~11
					var handle = Math.round( Math.random()*11 );
					rotateInProblem(handle);
					rotateInProblem(handle);
					break;

				case 3:
				
					// サニーミルク
					talkText='サニーミルク 「縦回転と 横回転に順番があるのね」';
					
					// アトランダムでハンドルを２つ選び、それを １つずつ進めるだけ。					
					var verticalHandles = [0, 1, 6, 7];
					var horizontalHandles = [2, 3, 8, 9];
					
					var handle0 = verticalHandles[ Math.round( Math.random()*3 )];
					var handle1 = horizontalHandles[ Math.round( Math.random()*3 )];
					
					rotateInProblem(handle0);
					rotateInProblem(handle1);
					break;

				case 4:
				
					// 河城にとり
					talkText='河城にとり 「３つは同じ色なのに、１つだけ違う色になってしまった。揃えてくれないか？」';

					/*
					// 初期位置から 5,8,10 と捻るのが ヒント通り。ただ、それだと簡単。
					rotateInProblem(5);
					rotateInProblem(8);
					rotateInProblem(10);
					
					// そこで、アングルを１回倒す。
					// 0~5
					var bigHandle = Math.round( Math.random()*5 );
					rotateAngle(bigHandle);
					rotateAngle(bigHandle);
					break;
					*/

					// 自由にやるなら、
					// ２軸に ひねり、次に同じ２軸を逆にひねる。これで１か所はぐれる。
					var verticalHandles = [0, 1, 6, 7];
					var horizontalHandles = [2, 3, 8, 9];
					var dialHandles = [4, 5, 10, 11];
					
					var handle0;
					var handle1;
					
					// 0～2
					switch(Math.round( Math.random()*2 ))
					{
						case 0:
							handle0 = verticalHandles[ Math.round( Math.random()*3 )];
							handle1 = horizontalHandles[ Math.round( Math.random()*3 )];
							break;
						case 1:
							handle0 = verticalHandles[ Math.round( Math.random()*3 )];
							handle1 = dialHandles[ Math.round( Math.random()*3 )];
							break;
						default:
							handle0 = horizontalHandles[ Math.round( Math.random()*3 )];
							handle1 = dialHandles[ Math.round( Math.random()*3 )];
							break;
					}
					
					rotateInProblem(handle0);
					rotateInProblem(handle1);
					rotateInProblem(getReversedHandle(handle0));
					break;
					
				case 5:
				
					// 高麗野あうん
					talkText='高麗野あうん 「回す方向は３つあるのですよ」';
					
					// ３つの軸から１つずつ選び、それらを １つずつ進めるだけ。					
					var verticalHandles = [0, 1, 6, 7];
					var horizontalHandles = [2, 3, 8, 9];
					var dialHandles = [4, 5, 10, 11];
					
					var handle0 = verticalHandles[ Math.round( Math.random()*3 )];
					var handle1 = horizontalHandles[ Math.round( Math.random()*3 )];
					var handle2 = dialHandles[ Math.round( Math.random()*3 )];
					
					rotateInProblem(handle0);
					rotateInProblem(handle1);
					rotateInProblem(handle2);
					break;

				case 6:
				
					// 鈴瑚
					talkText='鈴瑚 「両手で 団子３個食ってる間に終わる。最初の１回で ２色団子を揃えるのが決め手」';
					
					// まず、２つの軸を選ぶ。あとは 0、1、 と進めて、最後は 0 を逆回転。										
					var verticalHandles = [0, 1, 6, 7];
					var horizontalHandles = [2, 3, 8, 9];
					var dialHandles = [4, 5, 10, 11];
					
					var handle0;
					var handle1;
					
					// 0～2
					switch(Math.round( Math.random()*2 ))
					{
						case 0:
							handle0 = verticalHandles[ Math.round( Math.random()*3 )];
							handle1 = horizontalHandles[ Math.round( Math.random()*3 )];
							break;
						case 1:
							handle0 = verticalHandles[ Math.round( Math.random()*3 )];
							handle1 = dialHandles[ Math.round( Math.random()*3 )];
							break;
						default:
							handle0 = horizontalHandles[ Math.round( Math.random()*3 )];
							handle1 = dialHandles[ Math.round( Math.random()*3 )];
							break;
					}
					
					// 0
					rotateInProblem(handle0);

					// 1
					rotateInProblem(handle1);

					// 0 を逆回転。					
					rotateInProblem(getReversedHandle(handle0));
					break;

				case 7:
				
					// 紅美鈴
					talkText='紅美鈴 「１、２、１、２の呼吸です！ 角のちょうつがいの色を揃えていきましょう」';
					
					// まず、２つの軸を選ぶ。あとは交互に回すだけ。										
					var verticalHandles = [0, 1, 6, 7];
					var horizontalHandles = [2, 3, 8, 9];
					var dialHandles = [4, 5, 10, 11];
					
					var handle0;
					var handle1;
					
					// 0～2
					switch(Math.round( Math.random()*2 ))
					{
						case 0:
							handle0 = verticalHandles[ Math.round( Math.random()*3 )];
							handle1 = horizontalHandles[ Math.round( Math.random()*3 )];
							break;
						case 1:
							handle0 = verticalHandles[ Math.round( Math.random()*3 )];
							handle1 = dialHandles[ Math.round( Math.random()*3 )];
							break;
						default:
							handle0 = horizontalHandles[ Math.round( Math.random()*3 )];
							handle1 = dialHandles[ Math.round( Math.random()*3 )];
							break;
					}
					
					rotateInProblem(handle0);
					rotateInProblem(handle1);
					rotateInProblem(handle0);
					rotateInProblem(handle1);
					break;

				case 12:
				default:
				
					// 八雲紫
					talkText='八雲紫 「ランダムな問題に　美しさは感じないもの」';

					// とりあえず、ランダムにシャッフル。
					var count = Math.round( Math.random()*40 ) + 40;
					for(i=0; i<count; i++)
					{
						// 0~11
						var handle = Math.round( Math.random()*11 );
						rotateInProblem(handle);
					}
					break;
			}
			
			// 棋譜クリアー。
			record = "";
			document.getElementById("record").innerHTML = record;
			
			saveProblem();
		}
		
		/** 指定の回数、ランダムにキューブをねじります。 */
		function shuffle(count)
		{
			
			for(i=0; i<count; i++)
			{
				// 0~11
				var handle = Math.round( Math.random()*11 );
				rotateAndRecord(handle, handle);
			}
		}

		var diaSrcSave = [];
		var tileSrcSave = [];
		
		/** 問題をリセットできるよう、記憶しておく。 */
		function saveProblem()
		{
			for(i=0; i<24; i++)
			{
				diaSrcSave[i] = document.getElementById("dia-" + i).src;
				tileSrcSave[i] = document.getElementById("tile-" + i).src;
			}
		}
		
		/** 問題を復元する。 */
		function restoreProblem()
		{
			for(i=0; i<24; i++)
			{
				document.getElementById("dia-" + i).src = diaSrcSave[i];
				document.getElementById("tile-" + i).src = tileSrcSave[i];
			}
			
			// 棋譜。
			record = "";
			document.getElementById("record").innerHTML = record;
			document.getElementById("answer").innerHTML = "";
			
			// 判定。
			judge();
		}

		/** 揃っている状態に戻します。 */
		function reset()
		{
			// フロント、バック。
			document.getElementById("dia-0").src = "./img/diamond-c-orange.png";
			document.getElementById("dia-1").src = "./img/diamond-c-orange.png";
			document.getElementById("dia-2").src = "./img/diamond-c-orange.png";
			document.getElementById("dia-3").src = "./img/diamond-c-orange.png";
			document.getElementById("dia-4").src = "./img/diamond-b-violet.png";
			document.getElementById("dia-5").src = "./img/diamond-b-violet.png";
			document.getElementById("dia-6").src = "./img/diamond-b-violet.png";
			document.getElementById("dia-7").src = "./img/diamond-b-violet.png";
			document.getElementById("dia-8").src = "./img/diamond-a-pink.png";
			document.getElementById("dia-9").src = "./img/diamond-a-pink.png";
			document.getElementById("dia-10").src = "./img/diamond-a-pink.png";
			document.getElementById("dia-11").src = "./img/diamond-a-pink.png";
			document.getElementById("dia-12").src = "./img/diamond-c-sky-blue.png";
			document.getElementById("dia-13").src = "./img/diamond-c-sky-blue.png";
			document.getElementById("dia-14").src = "./img/diamond-c-sky-blue.png";
			document.getElementById("dia-15").src = "./img/diamond-c-sky-blue.png";
			document.getElementById("dia-16").src = "./img/diamond-a-gray.png";
			document.getElementById("dia-17").src = "./img/diamond-a-gray.png";
			document.getElementById("dia-18").src = "./img/diamond-a-gray.png";
			document.getElementById("dia-19").src = "./img/diamond-a-gray.png";
			document.getElementById("dia-20").src = "./img/diamond-b-yellow-green.png";
			document.getElementById("dia-21").src = "./img/diamond-b-yellow-green.png";
			document.getElementById("dia-22").src = "./img/diamond-b-yellow-green.png";
			document.getElementById("dia-23").src = "./img/diamond-b-yellow-green.png";
		
			// 展開図。
			document.getElementById("tile-0").src = "./img/tile-orange.png";
			document.getElementById("tile-1").src = "./img/tile-orange.png";
			document.getElementById("tile-2").src = "./img/tile-orange.png";
			document.getElementById("tile-3").src = "./img/tile-orange.png";
			document.getElementById("tile-4").src = "./img/tile-violet.png";
			document.getElementById("tile-5").src = "./img/tile-violet.png";
			document.getElementById("tile-6").src = "./img/tile-violet.png";
			document.getElementById("tile-7").src = "./img/tile-violet.png";
			document.getElementById("tile-8").src = "./img/tile-pink.png";
			document.getElementById("tile-9").src = "./img/tile-pink.png";
			document.getElementById("tile-10").src = "./img/tile-pink.png";
			document.getElementById("tile-11").src = "./img/tile-pink.png";
			document.getElementById("tile-12").src = "./img/tile-sky-blue.png";
			document.getElementById("tile-13").src = "./img/tile-sky-blue.png";
			document.getElementById("tile-14").src = "./img/tile-sky-blue.png";
			document.getElementById("tile-15").src = "./img/tile-sky-blue.png";
			document.getElementById("tile-16").src = "./img/tile-gray.png";
			document.getElementById("tile-17").src = "./img/tile-gray.png";
			document.getElementById("tile-18").src = "./img/tile-gray.png";
			document.getElementById("tile-19").src = "./img/tile-gray.png";
			document.getElementById("tile-20").src = "./img/tile-yellow-green.png";
			document.getElementById("tile-21").src = "./img/tile-yellow-green.png";
			document.getElementById("tile-22").src = "./img/tile-yellow-green.png";
			document.getElementById("tile-23").src = "./img/tile-yellow-green.png";
			
			// 回転ボタン
			document.getElementById("front-r0-button").textContent = "0";
			document.getElementById("front-r1-button").textContent = "1";
			document.getElementById("front-r2-button").textContent = "2";
			document.getElementById("front-r3-button").textContent = "3";
			document.getElementById("front-r4-button").textContent = "4";
			document.getElementById("front-r5-button").textContent = "5";
			document.getElementById("front-r6-button").textContent = "6";
			document.getElementById("front-r7-button").textContent = "7";
			document.getElementById("front-r8-button").textContent = "8";
			document.getElementById("front-r9-button").textContent = "9";
			document.getElementById("front-r10-button").textContent = "10";
			document.getElementById("front-r11-button").textContent = "11";
			
			document.getElementById("back-r0-button").textContent = "0";
			document.getElementById("back-r1-button").textContent = "1";
			document.getElementById("back-r2-button").textContent = "2";
			document.getElementById("back-r3-button").textContent = "3";
			document.getElementById("back-r4-button").textContent = "4";
			document.getElementById("back-r5-button").textContent = "5";
			document.getElementById("back-r6-button").textContent = "6";
			document.getElementById("back-r7-button").textContent = "7";
			document.getElementById("back-r8-button").textContent = "8";
			document.getElementById("back-r9-button").textContent = "9";
			document.getElementById("back-r10-button").textContent = "10";
			document.getElementById("back-r11-button").textContent = "11";
		}
		
		/** タイトル画面に戻る。 */
		function exit(count)
		{
			init();			
		}
		
		/** 勝利判定。 */
		function judge()
		{
			// まず隠しておく。
			document.getElementById("congratulations").style.visibility = "hidden";
			document.getElementById("go-to-next-stage").style.visibility = "hidden";

			// 天面
			if ( document.getElementById("tile-0").src != document.getElementById("tile-1").src ||
				document.getElementById("tile-1").src != document.getElementById("tile-2").src ||
				document.getElementById("tile-2").src != document.getElementById("tile-3").src) {
				return;
			}
			
			// 横面１
			if ( document.getElementById("tile-4").src != document.getElementById("tile-5").src ||
				document.getElementById("tile-5").src != document.getElementById("tile-6").src ||
				document.getElementById("tile-6").src != document.getElementById("tile-7").src) {
				return;
			}
			
			// 横面２
			if ( document.getElementById("tile-8").src != document.getElementById("tile-9").src ||
				document.getElementById("tile-9").src != document.getElementById("tile-10").src ||
				document.getElementById("tile-10").src != document.getElementById("tile-11").src) {
				return;
			}
			
			// 横面３
			if ( document.getElementById("tile-12").src != document.getElementById("tile-13").src ||
				document.getElementById("tile-13").src != document.getElementById("tile-14").src ||
				document.getElementById("tile-14").src != document.getElementById("tile-15").src) {
				return;
			}
			
			// 横面４
			if ( document.getElementById("tile-16").src != document.getElementById("tile-17").src ||
				document.getElementById("tile-17").src != document.getElementById("tile-18").src ||
				document.getElementById("tile-18").src != document.getElementById("tile-19").src) {
				return;
			}
			
			// 地面
			if ( document.getElementById("tile-20").src != document.getElementById("tile-21").src ||
				document.getElementById("tile-21").src != document.getElementById("tile-22").src ||
				document.getElementById("tile-22").src != document.getElementById("tile-23").src) {
				return;
			}
		
			// ６面で それぞれ４タイル一致していれば。
			document.getElementById("congratulations").style.visibility = "visible";
			document.getElementById("go-to-next-stage").style.visibility = "visible";
		}
		
		/** 再挑戦。 */
		function rechallenge()
		{
			reset();
			
			// 同じ問題を復元します。
			restoreProblem();
		}
		
		/** 解答を見る。 */
		function showAnswer()
		{
			let answer = "";
		
			// 棋譜に、回答を逆さに入れる。
			for(i=answerList.length-1; -1<i; i--)
			{
				answer += " " + answerList[i];
			}
			document.getElementById("answer").innerHTML = answer;
		}
		
		/** 回転ボタンをクリックしたとき。 */
		function clickRotateButton(handle, button)
		{
			rotateAndRecord(handle, button.textContent);
		}
	</script>
</head>
<body style="background-color:white;" onload="init(); start_timer();">

	<div style="position:absolute; top:0px; left:0px; width:1920px; height:1080px; background-color:#eeeeff;">
		<img id="title" src="./img/title.png" style="visibility:hidden; position:absolute; top:0px;" />
		<div id="title-scene" style="visibility:hidden; position:absolute; top:0px; left:0px; width:100%; height:100%; background-image:url('./img/window1.png');">
			<a href="javascript: void(0);" style="position:absolute; left:560px; top:550px; font-size:32px;" onclick="startStage(1);">1.チルノ レベル</a>
			<a href="javascript: void(0);" style="position:absolute; left:560px; top:590px; font-size:32px;" onclick="startStage(2);">2.宮古芳香 レベル</a>
			<a href="javascript: void(0);" style="position:absolute; left:560px; top:630px; font-size:32px;" onclick="startStage(3);">3.サニーミルク レベル</a>
			<a href="javascript: void(0);" style="position:absolute; left:560px; top:670px; font-size:32px;" onclick="startStage(4);">4.河城にとり レベル</a>
			<a href="javascript: void(0);" style="position:absolute; left:560px; top:710px; font-size:32px;" onclick="startStage(5);">5.高麗野あうん レベル</a>
			<a href="javascript: void(0);" style="position:absolute; left:560px; top:750px; font-size:32px;" onclick="startStage(6);">6.鈴瑚　レベル</a>
			<a href="javascript: void(0);" style="position:absolute; left:960px; top:550px; font-size:32px;" onclick="startStage(7);">7.紅美鈴　レベル</a>
			<!-- TODO もっと簡単なレベルを用意せな……☆ -->
			<!--
			<a href="javascript: problemId=8; talkText='雲居一輪 レベル'; void(0);" style="position:absolute; left:960px; top:590px; font-size:32px;" onclick="startStage();">8.雲井一輪 レベル</a>
			<a href="javascript: problemId=16; talkText='魔理沙 レベル'; void(0);" style="position:absolute; left:960px; top:630px; font-size:32px;" onclick="startStage();">9.魔理沙 レベル</a>
			<a href="javascript: problemId=23; talkText='宇佐美菫子 レベル'; void(0);" style="position:absolute; left:960px; top:670px; font-size:32px;" onclick="startStage();">10.宇佐美菫子 レベル</a>
			<a href="javascript: problemId=45; talkText='霊夢 レベル'; void(0);" style="position:absolute; left:960px; top:710px; font-size:32px;" onclick="startStage();">11.霊夢 レベル</a>
			-->
			<a href="javascript: void(0);" style="position:absolute; left:960px; top:750px; font-size:32px;" onclick="startStage(12);">12.八雲紫 レベル</a>
		</div>
		<div id="development-scene" style="visibility:hidden; position:absolute; top:0px; left:0px; width:100%; height:100%; background-image:url('./img/development.png');">
			<!--
				フロント
				     8
				10       9
				    11
				   
				20       12
				   21 14
				22       13
				   23 15
			-->
			<img id="dia-8" style="position:absolute; left:704px; top:272px; width:128px; height:64px;" />
			<img id="dia-9" style="position:absolute; left:800px; top:320px; width:128px; height:64px;" />
			<img id="dia-10" style="position:absolute; left:608px; top:320px; width:128px; height:64px;" />
			<img id="dia-11" style="position:absolute; left:704px; top:368px; width:128px; height:64px;" />

			<img id="dia-20" style="position:absolute; left:608px; top:384px; width:64px; height:96px;" />
			<img id="dia-21" style="position:absolute; left:704px; top:432px; width:64px; height:96px;" />
			<img id="dia-22" style="position:absolute; left:608px; top:480px; width:64px; height:96px;" />
			<img id="dia-23" style="position:absolute; left:704px; top:528px; width:64px; height:96px;" />

			<img id="dia-14" style="position:absolute; left:768px; top:432px; width:64px; height:96px;" />
			<img id="dia-12" style="position:absolute; left:864px; top:384px; width:64px; height:96px;" />
			<img id="dia-15" style="position:absolute; left:768px; top:528px; width:64px; height:96px;" />
			<img id="dia-13" style="position:absolute; left:864px; top:480px; width:64px; height:96px;" />
			
			<!--
				バック
				   2  5
				 3       7
				   0  4
				 1       6
				
				    17
				16      19
				    18
			-->
			<img id="dia-3" style="position:absolute; left:64px; top:336px; width:64px; height:96px;" />
			<img id="dia-2" style="position:absolute; left:160px; top:288px; width:64px; height:96px;" />
			<img id="dia-1" style="position:absolute; left:64px; top:432px; width:64px; height:96px;" />
			<img id="dia-0" style="position:absolute; left:160px; top:384px; width:64px; height:96px;" />

			<img id="dia-5" style="position:absolute; left:224px; top:288px; width:64px; height:96px;" />
			<img id="dia-7" style="position:absolute; left:320px; top:336px; width:64px; height:96px;" />
			<img id="dia-4" style="position:absolute; left:224px; top:384px; width:64px; height:96px;" />
			<img id="dia-6" style="position:absolute; left:320px; top:432px; width:64px; height:96px;" />

			<img id="dia-17" style="position:absolute; left:160px; top:480px; width:128px; height:64px;" />
			<img id="dia-19" style="position:absolute; left:256px; top:528px; width:128px; height:64px;" />
			<img id="dia-18" style="position:absolute; left:160px; top:576px; width:128px; height:64px;" />
			<img id="dia-16" style="position:absolute; left:64px; top:528px; width:128px; height:64px;" />
			
			<!--
				展開図
				       0  1
				       2  3
				 4  5  8  9 12 13 16 17
				 6  7 10 11 14 15 18 19
				      20 21
					  22 23
			-->
			<img id="tile-0" style="position:absolute; left:144px; top:688px; width:48px; height:48px;" />
			<img id="tile-1" style="position:absolute; left:208px; top:688px; width:48px; height:48px;" />
			<img id="tile-2" style="position:absolute; left:144px; top:752px; width:48px; height:48px;" />
			<img id="tile-3" style="position:absolute; left:208px; top:752px; width:48px; height:48px;" />

			<img id="tile-4" style="position:absolute; left:16px; top:816px; width:48px; height:48px;" />
			<img id="tile-5" style="position:absolute; left:80px; top:816px; width:48px; height:48px;" />
			<img id="tile-6" style="position:absolute; left:16px; top:880px; width:48px; height:48px;" />
			<img id="tile-7" style="position:absolute; left:80px; top:880px; width:48px; height:48px;" />

			<img id="tile-8" style="position:absolute; left:144px; top:816px; width:48px; height:48px;" />
			<img id="tile-9" style="position:absolute; left:208px; top:816px; width:48px; height:48px;" />
			<img id="tile-10" style="position:absolute; left:144px; top:880px; width:48px; height:48px;" />
			<img id="tile-11" style="position:absolute; left:208px; top:880px; width:48px; height:48px;" />

			<img id="tile-12" style="position:absolute; left:272px; top:816px; width:48px; height:48px;" />
			<img id="tile-13" style="position:absolute; left:336px; top:816px; width:48px; height:48px;" />
			<img id="tile-14" style="position:absolute; left:272px; top:880px; width:48px; height:48px;" />
			<img id="tile-15" style="position:absolute; left:336px; top:880px; width:48px; height:48px;" />

			<img id="tile-16" style="position:absolute; left:400px; top:816px; width:48px; height:48px;" />
			<img id="tile-17" style="position:absolute; left:464px; top:816px; width:48px; height:48px;" />
			<img id="tile-18" style="position:absolute; left:400px; top:880px; width:48px; height:48px;" />
			<img id="tile-19" style="position:absolute; left:464px; top:880px; width:48px; height:48px;" />
			
			<img id="tile-20" style="position:absolute; left:144px; top:944px; width:48px; height:48px;" />
			<img id="tile-21" style="position:absolute; left:208px; top:944px; width:48px; height:48px;" />
			<img id="tile-22" style="position:absolute; left:144px; top:1008px; width:48px; height:48px;" />
			<img id="tile-23" style="position:absolute; left:208px; top:1008px; width:48px; height:48px;" />

			<!-- ボタンの下に表示する。 -->
			<img id="hint" style="position:absolute; left:1104px; top:160px; width:400px; height:320px;" />
			<img id="face" style="position:absolute; left:1504px; top:160px; width:400px; height:320px;" />
			<img id="congratulations" src="./img/congratulations.png" style="visibility:hidden; position:absolute; left:0px; top:0px;" />
			
			<!-- ボタン。 -->
			<a href="javascript: rechallenge();" style="position:absolute; left:1120px; top:48px; font-size:20px;">再挑戦</a>
			<a href="javascript: exit();" style="position:absolute; left:1120px; top:80px; font-size:20px;">Exit</a>
			<a href="javascript: showAnswer();" style="position:absolute; left:1120px; top:112px; font-size:20px;">解答を見る</a>
			<span id="talkText" style="position:absolute; left:1120px; top:512px; width:768px; height:160px; font-size:28px; font-weight:bold;">台詞</span>
			<span id="record" style="position:absolute; left:628px; top:914px; width:1264px; height:64px; font-size:28px;"></span>
			<span id="answer" style="position:absolute; left:624px; top:992px; width:1264px; height:64px; font-size:28px; color:orange;"></span>
			<a id="go-to-next-stage" href="javascript: startNextStage();" style="position:absolute; left:624px; top:832px; font-size:48px;">Go to next stage!</a>

			<!-- フロント 回転ボタン。 -->
			<button id="front-r0-button" style="position:absolute; left:832px; top:256px; font-size:24px;" onclick="clickRotateButton(0, this)"></button>
			<button id="front-r1-button" style="position:absolute; left:928px; top:320px; font-size:24px;" onclick="clickRotateButton(1, this)"></button>
			<button id="front-r2-button" style="position:absolute; left:928px; top:416px; font-size:24px;" onclick="clickRotateButton(2, this)"></button>
			<button id="front-r3-button" style="position:absolute; left:928px; top:512px; font-size:24px;" onclick="clickRotateButton(3, this)"></button>
			<button id="front-r4-button" style="position:absolute; left:864px; top:608px; font-size:24px;" onclick="clickRotateButton(4, this)"></button>
			<button id="front-r5-button" style="position:absolute; left:768px; top:640px; font-size:24px;" onclick="clickRotateButton(5, this)"></button>
			<button id="front-r6-button" style="position:absolute; left:704px; top:640px; font-size:24px;" onclick="clickRotateButton(6, this)"></button>
			<button id="front-r7-button" style="position:absolute; left:608px; top:608px; font-size:24px;" onclick="clickRotateButton(7, this)"></button>
			<button id="front-r8-button" style="position:absolute; left:544px; top:512px; font-size:24px;" onclick="clickRotateButton(8, this)"></button>
			<button id="front-r9-button" style="position:absolute; left:544px; top:416px; font-size:24px;" onclick="clickRotateButton(9, this)"></button>
			<button id="front-r10-button" style="position:absolute; left:544px; top:320px; font-size:24px;" onclick="clickRotateButton(10, this)"></button>
			<button id="front-r11-button" style="position:absolute; left:640px; top:256px; font-size:24px;" onclick="clickRotateButton(11, this)"></button>
			
			<!-- フロント 視角ボタン。 -->
			<a href="javascript: rotateAngle(0);" style="position:absolute; left:928px; top:240px; font-size:20px;">+Y</a>
			<a href="javascript: rotateAngle(1);" style="position:absolute; left:992px; top:448px; font-size:20px;">+Z</a>
			<a href="javascript: rotateAngle(2);" style="position:absolute; left:816px; top:672px; font-size:20px;">+X</a>
			<a href="javascript: rotateAngle(3);" style="position:absolute; left:656px; top:672px; font-size:20px;">-Y</a>
			<a href="javascript: rotateAngle(4);" style="position:absolute; left:480px; top:448px; font-size:20px;">-Z</a>
			<a href="javascript: rotateAngle(5);" style="position:absolute; left:554px; top:240px; font-size:20px;">-X</a>

			<!-- バック 回転ボタン。 -->
			<button id="back-r4-button" style="position:absolute; left:224px; top:240px; font-size:24px;" onclick="clickRotateButton(4, this)"></button>
			<button id="back-r5-button" style="position:absolute; left:320px; top:272px; font-size:24px;" onclick="clickRotateButton(5, this)"></button>
			<button id="back-r2-button" style="position:absolute; left:384px; top:368px; font-size:24px;" onclick="clickRotateButton(2, this)"></button>
			<button id="back-r3-button" style="position:absolute; left:384px; top:464px; font-size:24px;" onclick="clickRotateButton(3, this)"></button>
			<button id="back-r0-button" style="position:absolute; left:384px; top:560px; font-size:24px;" onclick="clickRotateButton(0, this)"></button>
			<button id="back-r1-button" style="position:absolute; left:272px; top:624px; font-size:24px;" onclick="clickRotateButton(1, this)"></button>
			<button id="back-r10-button" style="position:absolute; left:112px; top:624px; font-size:24px;" onclick="clickRotateButton(10, this)"></button>
			<button id="back-r11-button" style="position:absolute; left:0px; top:560px; font-size:24px;" onclick="clickRotateButton(11, this)"></button>			
			<button id="back-r8-button" style="position:absolute; left:0px; top:464px; font-size:24px;" onclick="clickRotateButton(8, this)"></button>
			<button id="back-r9-button" style="position:absolute; left:0px; top:368px; font-size:24px;" onclick="clickRotateButton(9, this)"></button>
			<button id="back-r6-button" style="position:absolute; left:64px; top:272px; font-size:24px;" onclick="clickRotateButton(6, this)"></button>
			<button id="back-r7-button" style="position:absolute; left:160px; top:240px; font-size:24px;" onclick="clickRotateButton(7, this)"></button>
		</div>
	</div>

	<!-- 裏を隠す板。 -->
	<div style="position:absolute; top:0px; left:1920px; width:1920px; height:1080px; background-color:white;">
	</div>
	
</body>
</html>
